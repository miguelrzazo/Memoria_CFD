%========================================
% CAPITULO 4: ESQUEMAS NUMERICOS - FVM Y TUBO DE CHOQUE
%========================================
\chapter{Esquemas Numéricos: Método de Volúmenes Finitos}
\label{chap:ejercicio4}

%========================================
\section*{Introducción}
\addcontentsline{toc}{section}{Introducción}
%========================================

La discretización espacial de las ecuaciones de conservación en el método de volúmenes finitos (FVM) constituye uno de los aspectos fundamentales que determinan la precisión y estabilidad de las soluciones numéricas en CFD. La elección del esquema numérico para aproximar los flujos convectivos en las caras de los volúmenes de control tiene un impacto directo en la capacidad del método para resolver correctamente fenómenos con gradientes pronunciados, discontinuidades y ondas de choque~\cite{blazek2015cfd,versteeg2007introduction}.

Este capítulo aborda el estudio de los esquemas numéricos desde dos perspectivas complementarias:

\begin{itemize}
    \item \textbf{Sección~\ref{sec:fvm_matlab}:} Implementación del método de volúmenes finitos en MATLAB para resolver la ecuación de convección-difusión unidimensional, verificando los resultados con la solución analítica exacta.
    \item \textbf{Sección~\ref{sec:shocktube}:} Simulación del tubo de choque de Sod en OpenFOAM, comparando esquemas de bajo orden (\textit{upwind}) y alto orden (\textit{linearUpwind}) para evaluar su capacidad de captura de discontinuidades.
\end{itemize}

%========================================
%========================================
\section{Método de Volúmenes Finitos en MATLAB}
\label{sec:fvm_matlab}
%========================================
%========================================

%========================================
\subsection{Objetivo}
%========================================

El objetivo de esta sección es implementar el método de volúmenes finitos (FVM) para resolver la ecuación de convección-difusión unidimensional en régimen estacionario:

\begin{equation}
    \frac{d(\rho u \phi)}{dx} = \frac{d}{dx}\left(\Gamma \frac{d\phi}{dx}\right)
    \label{eq:convdiff}
\end{equation}

donde $\phi$ es la variable transportada, $\rho$ la densidad, $u$ la velocidad de convección y $\Gamma$ el coeficiente de difusión.

Los objetivos específicos son:
\begin{itemize}
    \item Discretizar la ecuación~\eqref{eq:convdiff} mediante el esquema \textit{upwind} para el término convectivo y diferencias centrales para el difusivo.
    \item Verificar la implementación comparando con los valores de referencia del enunciado.
    \item Analizar el efecto del número de Péclet ($Pe = \rho u L / \Gamma$) en la solución.
    \item Estudiar la convergencia de malla del esquema numérico.
\end{itemize}

%========================================
\subsection{Fundamento teórico: Discretización FVM}
%========================================

\subsubsection{Formulación integral}

El método de volúmenes finitos parte de la forma integral de la ecuación de conservación. Integrando la Ec.~\eqref{eq:convdiff} sobre un volumen de control $\Delta V$ y aplicando el teorema de Gauss:

\begin{equation}
    \int_S (\rho u \phi) \cdot dS = \int_S \left(\Gamma \frac{d\phi}{dx}\right) \cdot dS
\end{equation}

Para una celda 1D de longitud $\Delta x$, esto se reduce a:

\begin{equation}
    (\rho u \phi)_e - (\rho u \phi)_w = \left(\Gamma \frac{d\phi}{dx}\right)_e - \left(\Gamma \frac{d\phi}{dx}\right)_w
    \label{eq:fvm_discreto}
\end{equation}

donde los subíndices $e$ y $w$ denotan las caras este y oeste del volumen de control.

\subsubsection{Esquema Upwind}

Para evaluar el flujo convectivo en las caras, el esquema \textit{upwind} utiliza el valor de la celda aguas arriba:

\begin{equation}
    \phi_e = \begin{cases}
        \phi_P & \text{si } u > 0 \\
        \phi_E & \text{si } u < 0
    \end{cases}
\end{equation}

Este esquema garantiza estabilidad pero introduce difusión numérica de orden $O(\Delta x)$.

\subsubsection{Sistema lineal resultante}

La discretización genera un sistema tridiagonal $A\phi = b$ con coeficientes:

\begin{equation}
    a_W \phi_W + a_P \phi_P + a_E \phi_E = S_u
\end{equation}

donde los coeficientes dependen del flujo convectivo $F = \rho u$ y el coeficiente difusivo $D = \Gamma/\Delta x$.

%========================================
\subsection{Configuración del problema}
%========================================

Se resolvió el problema de convección-difusión con los siguientes parámetros:

\begin{itemize}
    \item Longitud del dominio: $L = 1$ m
    \item Densidad: $\rho = 1$ kg/m$^3$
    \item Coeficiente de difusión: $\Gamma = 0.1$ kg/(m$\cdot$s)
    \item Condiciones de contorno: $\phi(0) = 1$, $\phi(L) = 0$
\end{itemize}

Se analizaron tres casos con diferentes velocidades y refinamientos de malla:

\begin{table}[h!]
\centering
\caption{Casos de estudio para el problema de convección-difusión}
\label{tab:fvm_casos}
\begin{tabular}{lccc}
\hline
\textbf{Caso} & \textbf{Velocidad} $u$ [m/s] & \textbf{Celdas} $N$ & \textbf{Péclet} $Pe$ \\
\hline
1 & 0.1 & 5 & 1.0 \\
2 & 2.5 & 5 & 25.0 \\
3 & 2.5 & 20 & 25.0 \\
\hline
\end{tabular}
\end{table}

La solución analítica exacta de la Ec.~\eqref{eq:convdiff} es:

\begin{equation}
    \phi(x) = \phi_A + (\phi_B - \phi_A) \frac{e^{Pe \cdot x/L} - 1}{e^{Pe} - 1}
    \label{eq:sol_analitica}
\end{equation}

%========================================
\subsection{Resultados}
%========================================

\subsubsection{Verificación del Caso 1}

La Fig.~\ref{fig:fvm_caso1} presenta la comparación entre la solución numérica FVM y la solución analítica para el Caso 1 ($u = 0.1$ m/s, $N = 5$ celdas, $Pe = 1$).

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.85\textwidth]{Ejercicio4/FVM_caso1_validacion.png}
    \caption{Caso 1: Validación de la implementación FVM con $u = 0.1$ m/s y $N = 5$ celdas. El número de Péclet $Pe = 1$ indica un balance entre convección y difusión.}
    \label{fig:fvm_caso1}
\end{figure}

Con $Pe = 1$, la convección y difusión tienen magnitudes comparables, resultando en un perfil suave que el esquema \textit{upwind} captura con buena precisión. Los valores numéricos coinciden con los de referencia del enunciado dentro del error de redondeo.

\subsubsection{Efecto de la velocidad}

La Fig.~\ref{fig:fvm_velocidad} muestra el efecto del incremento de la velocidad de convección para una malla fija de $N = 5$ celdas.

\begin{figure}[h!]
    \centering
    \includegraphics[width=\textwidth]{Ejercicio4/FVM_efecto_velocidad.png}
    \caption{Efecto de la velocidad de convección en la solución FVM. Al aumentar $Pe$, el perfil se vuelve más pronunciado y el esquema \textit{upwind} introduce mayor difusión numérica.}
    \label{fig:fvm_velocidad}
\end{figure}

Se observa que al aumentar el número de Péclet:
\begin{itemize}
    \item El perfil de $\phi$ se vuelve más abrupto, concentrándose la variación cerca del contorno de salida ($x = L$).
    \item La difusión numérica del esquema \textit{upwind} suaviza los gradientes, alejando la solución numérica de la analítica.
    \item Para $Pe = 25$, la discrepancia es significativa con solo 5 celdas.
\end{itemize}

\subsubsection{Efecto del refinamiento de malla}

La Fig.~\ref{fig:fvm_refinamiento} compara las soluciones con $N = 5$ y $N = 20$ celdas para el caso de alta convección ($u = 2.5$ m/s).

\begin{figure}[h!]
    \centering
    \includegraphics[width=\textwidth]{Ejercicio4/FVM_efecto_refinamiento.png}
    \caption{Efecto del refinamiento de malla: con $N = 20$ celdas, la solución FVM se aproxima mejor a la analítica al reducir la difusión numérica.}
    \label{fig:fvm_refinamiento}
\end{figure}

El refinamiento de malla reduce la difusión numérica proporcional a $\Delta x$, mejorando significativamente la aproximación a la solución exacta. Esto confirma la convergencia de primer orden del esquema \textit{upwind}.

\subsubsection{Resumen}

La Fig.~\ref{fig:fvm_resumen} presenta un resumen comparativo de los tres casos analizados.

\begin{figure}[h!]
    \centering
    \includegraphics[width=\textwidth]{Ejercicio4/FVM_resumen.png}
    \caption{Resumen de los tres casos de estudio FVM, mostrando la evolución de la solución con diferentes números de Péclet y refinamientos de malla.}
    \label{fig:fvm_resumen}
\end{figure}

%========================================
%========================================
\section{Tubo de Choque de Sod en OpenFOAM}
\label{sec:shocktube}
%========================================
%========================================

%========================================
\subsection{Objetivo}
%========================================

El objetivo de esta sección es analizar el efecto de los esquemas de discretización espacial en flujos compresibles mediante la simulación del problema del tubo de choque de Sod en OpenFOAM, respondiendo a las siguientes cuestiones:

\begin{enumerate}
    \item Simular el problema con esquemas de alto orden espacial y validar con la solución analítica.
    \item Explicar las fórmulas matemáticas de los esquemas upwind y linearUpwind, con sus ventajas e inconvenientes.
    \item Comparar los resultados de alto y bajo orden espacial mediante perfiles horizontales.
\end{enumerate}

%========================================
\subsection{El tubo de choque de Sod: Definición y aplicaciones}
\label{subsec:sod_definicion}
%========================================

El tubo de choque de Sod~\cite{sod1978survey} es un problema clásico de dinámica de gases que constituye un \textit{benchmark} fundamental para la validación de códigos de CFD compresible. Consiste en un tubo cerrado dividido inicialmente por una membrana que separa dos estados termodinámicos distintos:

\begin{itemize}
    \item \textbf{Estado izquierdo ($x < 0$):} Gas a alta presión y densidad.
    \item \textbf{Estado derecho ($x > 0$):} Gas a baja presión y densidad.
\end{itemize}

Al eliminar instantáneamente la membrana en el tiempo inicial, la discontinuidad inicial se descompone en tres ondas características que constituyen la solución del problema de Riemann:

\begin{enumerate}
    \item \textbf{Onda de expansión:} Se propaga hacia la izquierda como una expansión isentrópica continua que reduce gradualmente la presión y densidad del gas. A diferencia de las discontinuidades, la onda de expansión es una transición suave (abanico de expansión).

    \item \textbf{Discontinuidad de contacto:} Superficie material que separa fluidos de diferente densidad pero igual presión y velocidad. No hay transporte de masa a través de ella, solo advección de la interfaz.

    \item \textbf{Onda de choque:} Discontinuidad que incrementa bruscamente la presión, densidad y temperatura, propagándose hacia la derecha a velocidad supersónica respecto al gas en reposo.
\end{enumerate}

\textbf{Utilidad del problema de Sod:}
\begin{itemize}
    \item Posee solución analítica exacta, permitiendo validación cuantitativa de solvers numéricos.
    \item Contiene las tres estructuras fundamentales de flujos compresibles: expansiones, discontinuidades de contacto y ondas de choque.
    \item Permite evaluar la difusión numérica de los esquemas al capturar frentes discontinuos.
    \item Es computacionalmente económico al ser unidimensional.
\end{itemize}

La Fig.~\ref{fig:shock_xt} muestra el diagrama $x$-$t$ conceptual con las líneas características de las tres ondas, identificando las cuatro regiones del flujo.

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.75\textwidth]{Ejercicio4/shocktube_diagrama_xt.png}
    \caption{Diagrama $x$-$t$ del tubo de choque de Sod mostrando la propagación de las ondas características: onda de expansión (azul), discontinuidad de contacto (verde) y onda de choque (rojo). Las cuatro regiones corresponden a: (1) gas izquierdo sin perturbar, (2) gas expandido por la expansión, (3) gas comprimido entre contacto y choque, (4) gas derecho sin perturbar. El diafragma inicial se sitúa en $x = 0$.}
    \label{fig:shock_xt}
\end{figure}

\subsubsection{Física del problema}

La evolución temporal del sistema se rige por las ecuaciones de Euler para flujos compresibles:
\begin{equation}
    \frac{\partial \mathbf{U}}{\partial t} + \frac{\partial \mathbf{F}}{\partial x} = 0
\end{equation}
donde el vector de variables conservativas y el vector de flujos son:
\begin{equation}
    \mathbf{U} = \begin{pmatrix} \rho \\ \rho u \\ E \end{pmatrix}, \quad
    \mathbf{F} = \begin{pmatrix} \rho u \\ \rho u^2 + p \\ u(E + p) \end{pmatrix}
\end{equation}

La velocidad de propagación de cada onda viene determinada por las velocidades características del sistema:
\begin{itemize}
    \item \textbf{Onda de expansión:} Se propaga a velocidades entre $u - a$ (cabeza) y $u^* - a^*$ (cola), donde $a = \sqrt{\gamma p / \rho}$ es la velocidad del sonido.
    \item \textbf{Discontinuidad de contacto:} Se mueve con la velocidad del fluido $u^*$ en la región intermedia.
    \item \textbf{Onda de choque:} Velocidad supersónica respecto al gas en reposo, calculable mediante las relaciones de Rankine-Hugoniot.
\end{itemize}

%========================================
\subsection{Esquemas numéricos: Formulación matemática}
\label{subsec:esquemas_formulas}
%========================================

\subsubsection{Esquema Upwind (primer orden)}

El esquema \textit{upwind} evalúa el flujo convectivo en las caras utilizando el valor de la celda situada aguas arriba respecto a la dirección del flujo:

\begin{equation}
    \phi_f = \begin{cases}
        \phi_P & \text{si } \mathbf{u} \cdot \mathbf{n} > 0 \\
        \phi_N & \text{si } \mathbf{u} \cdot \mathbf{n} < 0
    \end{cases}
    \label{eq:upwind}
\end{equation}

donde $\phi_P$ es el valor en la celda propietaria, $\phi_N$ en la celda vecina, y $\mathbf{n}$ es el vector normal a la cara.

Mediante análisis de Taylor, el esquema upwind aproxima la derivada espacial con:
\begin{equation}
    \frac{\partial \phi}{\partial x} \approx \frac{\phi_P - \phi_W}{\Delta x} + O(\Delta x)
\end{equation}

\textbf{Ventajas:}
\begin{itemize}
    \item \textbf{Estabilidad incondicional:} No genera oscilaciones espurias cerca de discontinuidades.
    \item \textbf{Monotonicidad:} Preserva el principio del máximo, evitando valores no físicos.
    \item \textbf{Simplicidad:} Fácil implementación y bajo coste computacional.
\end{itemize}

\textbf{Inconvenientes:}
\begin{itemize}
    \item \textbf{Alta difusión numérica:} Introduce un término difusivo artificial proporcional a $\frac{1}{2}|u|\Delta x$, extendiendo las discontinuidades sobre 6--10 celdas.
    \item \textbf{Primer orden de precisión:} Error de truncación $O(\Delta x)$, requiriendo mallas muy finas para precisión aceptable.
\end{itemize}

\subsubsection{Esquema linearUpwind (segundo orden)}

El esquema \textit{linearUpwind} es un método de discretización de segundo orden que utiliza información de gradientes para reconstruir los valores en las caras de las celdas. La reconstrucción lineal se basa en:

\begin{equation}
    \phi_f = \phi_P + \nabla\phi_P \cdot \mathbf{d}_{Pf}
    \label{eq:linearupwind}
\end{equation}

donde $\nabla\phi_P$ es el gradiente calculado en la celda $P$, y $\mathbf{d}_{Pf}$ es el vector desde el centroide de $P$ hasta el centroide de la cara $f$.

Este esquema combina la estabilidad del upwind con mayor precisión mediante la extrapolación lineal en la dirección del flujo. El gradiente se calcula típicamente mediante el método de mínimos cuadrados o Gauss-Green.

\textbf{Ventajas:}
\begin{itemize}
    \item \textbf{Segundo orden de precisión:} Reduce significativamente la difusión numérica en regiones suaves.
    \item \textbf{Conservación:} Mantiene las propiedades de conservación del método de volúmenes finitos.
    \item \textbf{Implementación directa:} Utiliza los mismos gradientes calculados para otros términos (viscosidad, etc.).
\end{itemize}

\textbf{Inconvenientes:}
\begin{itemize}
    \item \textbf{Potencial de oscilaciones:} En presencia de discontinuidades fuertes puede generar valores no físicos.
    \item \textbf{Mayor coste computacional:} Requiere cálculo de gradientes en cada celda.
    \item \textbf{Dependencia de la calidad de malla:} Los gradientes pueden ser inexactos en mallas distorsionadas.
\end{itemize}

%========================================
\subsection{Configuración del caso OpenFOAM}
%========================================

\subsubsection{Condiciones iniciales}

\begin{table}[h!]
\centering
\caption{Condiciones iniciales del problema de Sod}
\label{tab:sod_ic}
\begin{tabular}{lccc}
\hline
\textbf{Región} & \textbf{Densidad} $\rho$ [kg/m$^3$] & \textbf{Presión} $p$ [Pa] & \textbf{Velocidad} $u$ [m/s] \\
\hline
Izquierda ($x < 0$) & 1.0 & 100\,000 & 0 \\
Derecha ($x > 0$) & 0.125 & 10\,000 & 0 \\
\hline
\end{tabular}
\end{table}

\subsubsection{Parámetros numéricos}

\begin{itemize}
    \item \textbf{Solver:} \texttt{foamRun} con modelo de fluido compresible.
    \item \textbf{Dominio:} $x \in [-5, 5]$ m, con 1000 celdas uniformes.
    \item \textbf{Gas:} Aire ideal con $\gamma = 1.4$.
    \item \textbf{Tiempo de simulación:} 0.15 s con CFL $< 0.5$.
\end{itemize}

\subsubsection{Configuración de esquemas}

La diferencia fundamental entre los dos casos simulados radica en el esquema de discretización espacial, manteniendo el esquema temporal.

\textbf{Caso bajo orden (upwind):}
\begin{lstlisting}[language=C++,basicstyle=\small\ttfamily]
ddtSchemes
{
    default     Euler;  // Primer orden temporal
}
divSchemes
{
    div(phi,U)   Gauss upwind;
    div(phid,p)  Gauss upwind;
    div(phi,e)   Gauss upwind;
}
\end{lstlisting}

\textbf{Caso alto orden (linearUpwind):}
\begin{lstlisting}[language=C++,basicstyle=\small\ttfamily]
ddtSchemes
{
    default     Euler;  // Primer orden temporal
}
divSchemes
{
    div(phi,U)   Gauss linearUpwind grad(U);
    div(phid,p)  Gauss linearUpwind grad(p);
    div(phi,e)   Gauss linearUpwind grad(e);
}
\end{lstlisting}

El esquema temporal es idéntico (Euler de primer orden) en ambos casos. La diferencia radica en los esquemas espaciales: el caso de bajo orden emplea \textit{upwind} (primer orden) para todos los términos convectivos, mientras que el caso de alto orden utiliza \textit{linearUpwind} (segundo orden) que aprovecha información de gradientes para mayor precisión.

Sin embargo, para una comparación más completa, se han configurado dos casos con esquemas temporales diferentes:
\begin{itemize}
    \item \textbf{Caso de bajo orden:} Euler (temporal, primer orden) + upwind (espacial, primer orden)
    \item \textbf{Caso de alto orden:} Crank-Nicolson (temporal, segundo orden) + linearUpwind (espacial, segundo orden)
\end{itemize}

%========================================
\subsection{Resultados: Validación con solución analítica}
\label{subsec:validacion}
%========================================

Para la comparación con la solución analítica, se emplea un tiempo físico correspondiente al instante en que las ondas características del problema de Sod están bien desarrolladas.

La Fig.~\ref{fig:shock_validacion} presenta la comparación entre las soluciones numéricas y la solución analítica en $t^* = 0.1$. La solución analítica se ha escalado mediante auto-similaridad para corresponder exactamente al tiempo de comparación.

\begin{figure}[h!]
    \centering
    \includegraphics[width=\textwidth]{Ejercicio4/shocktube_validacion.png}
    \caption{Validación del problema de Sod: comparación de los perfiles de densidad, presión y velocidad entre los esquemas numéricos (Euler + upwind y Crank-Nicolson + linearUpwind) y la solución analítica escalada.}
    \label{fig:shock_validacion}
\end{figure}

Se observa que ambos esquemas numéricos capturan correctamente la estructura de ondas características del problema de Sod: la onda de expansión propagándose hacia la izquierda, la discontinuidad de contacto en la región central, y la onda de choque avanzando hacia la derecha. Las diferencias entre esquemas temporales son sutiles a tiempos cortos, siendo el esquema espacial \textit{vanAlbada} el principal responsable de la captura de discontinuidades.

%========================================
\subsection{Resultados: Comparación de esquemas ($t^* = 0.15$)}
\label{subsec:comparacion}
%========================================

La Fig.~\ref{fig:shock_comparacion} presenta la comparación directa entre los esquemas mediante perfiles horizontales.

\begin{figure}[h!]
    \centering
    \includegraphics[width=\textwidth]{Ejercicio4/shocktube_comparacion.png}
    \caption{Comparación de esquemas numéricos: perfiles horizontales de densidad, presión y velocidad para esquema de alto orden espacial (linearUpwind, línea azul discontinua) y bajo orden espacial (upwind, línea naranja punteada), junto con la solución analítica (línea negra continua).}
    \label{fig:shock_comparacion}
\end{figure}

\subsubsection{Análisis comparativo detallado}

\textbf{Efecto del orden de discretización espacial:}

La diferencia fundamental entre ambas configuraciones radica en la precisión de la discretización espacial:

\begin{itemize}
    \item \textbf{Esquema upwind (bajo orden espacial):} Discretización de primer orden que introduce un error de truncación proporcional a $\Delta x$. Este error se manifiesta como difusión numérica excesiva, especialmente en regiones con gradientes pronunciados.

    \item \textbf{Esquema linearUpwind (alto orden espacial):} Discretización de segundo orden que utiliza información de gradientes para reconstruir los valores en las caras. Proporciona mayor precisión espacial sin generar oscilaciones no físicas.
\end{itemize}

\textbf{Comportamiento por región:}

\begin{enumerate}
    \item \textbf{Onda de expansión:} El esquema de alto orden espacial captura mejor la pendiente del abanico de expansión, mientras que el esquema upwind introduce mayor difusión numérica en esta región suave.

    \item \textbf{Discontinuidad de contacto:} Las diferencias son notables, ya que el esquema linearUpwind preserva mejor la nitidez del salto de densidad comparado con el esquema upwind de primer orden.

    \item \textbf{Onda de choque:} El frente de choque muestra mayor nitidez con el esquema linearUpwind. La difusión numérica es significativamente menor, permitiendo una mejor resolución del perfil de choque.
\end{enumerate}

\subsubsection{Tabla resumen de esquemas}

La Tabla~\ref{tab:esquemas_resumen} resume las características de cada configuración.

\begin{table}[h!]
\centering
\caption{Resumen comparativo de los esquemas numéricos empleados}
\label{tab:esquemas_resumen}
\begin{tabular}{lcc}
\hline
\textbf{Característica} & \textbf{Bajo orden} & \textbf{Alto orden} \\
\hline
Esquema temporal & Euler & Crank-Nicolson \\
Esquema convectivo (U) & Gauss upwind & Gauss linearUpwind grad(U) \\
Esquema convectivo (p, e) & Gauss upwind & Gauss linearUpwind grad(p) \\
Orden de precisión temporal & $O(\Delta t)$ & $O(\Delta t^2)$ \\
Orden de precisión espacial & $O(\Delta x)$ & $O(\Delta x^2)$ \\
Difusión numérica & Alta & Baja \\
Captura de discontinuidades & Difusa (varias celdas) & Nitida (2-3 celdas) \\
Coste computacional & Bajo & Medio (gradientes) \\
\hline
\end{tabular}
\end{table}

%========================================
\subsection{Evolución temporal}
%========================================

La evolución temporal del problema de Sod permite visualizar la propagación de las ondas características. Se ha generado una animación (GIF) que muestra la evolución de los campos de densidad, presión, temperatura y velocidad desde el tiempo inicial hasta el tiempo final de simulación, disponible en el directorio de figuras del repositorio.

Las principales observaciones de la evolución temporal son:

\begin{enumerate}
    \item \textbf{Establecimiento inicial:} Las discontinuidades comienzan a propagarse desde la posición del diafragma. El solver numérico resuelve gradualmente la condición inicial discontinua.

    \item \textbf{Propagación intermedia:} Las tres ondas se separan claramente:
    \begin{itemize}
        \item La onda de expansión avanza hacia la izquierda a velocidad supersónica.
        \item La discontinuidad de contacto se mueve hacia la derecha a velocidad intermedia.
        \item El choque avanza hacia la derecha a velocidad supersónica.
    \end{itemize}

    \item \textbf{Tiempo final:} Las ondas se aproximan a los extremos del dominio. La onda de expansión alcanza el límite izquierdo mientras que el choque continúa propagándose hacia el extremo derecho.
\end{enumerate}

La comparación visual entre los esquemas temporales de alto y bajo orden muestra diferencias sutiles en la posición exacta de las ondas. El esquema \textit{Crank-Nicolson} (segundo orden) preserva con mayor fidelidad la velocidad de propagación de las discontinuidades a lo largo de la simulación, mientras que el esquema \textit{Euler} (primer orden) introduce una ligera disipación adicional debido al error de truncación temporal acumulado.

La Fig.~\ref{fig:shock_evolucion} muestra la evolución temporal del campo de presión, ilustrando la propagación de las ondas características desde el diafragma inicial.

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.9\textwidth]{Ejercicio4/shocktube_evolucion_presion.png}
    \caption{Evolución temporal del campo de presión en el tubo de choque de Sod (esquema de alto orden). Se observa la propagación de la onda de expansión hacia la izquierda y la onda de choque hacia la derecha, con la discontinuidad de contacto en posición intermedia.}
    \label{fig:shock_evolucion}
\end{figure}

%========================================
\section{Conclusiones}
%========================================

El análisis de los esquemas numéricos mediante la implementación FVM en MATLAB y la simulación del tubo de choque de Sod en OpenFOAM ha permitido extraer las siguientes conclusiones:

\textbf{Sección~\ref{sec:fvm_matlab} -- Método de Volúmenes Finitos:}
\begin{enumerate}
    \item La implementación FVM con esquema \textit{upwind} reproduce correctamente la solución analítica de la ecuación de convección-difusión.
    \item El número de Péclet determina el carácter del problema: para $Pe \gg 1$, la convección domina y se requiere mayor resolución de malla.
    \item La difusión numérica del esquema \textit{upwind} es proporcional a $\Delta x$, confirmando su convergencia de primer orden.
\end{enumerate}

\textbf{Sección~\ref{sec:shocktube} -- Tubo de Choque de Sod:}
\begin{enumerate}
    \item El tubo de choque de Sod constituye un \textit{benchmark} fundamental para validar solvers compresibles, conteniendo las tres estructuras características: expansión, discontinuidad de contacto y onda de choque.

    \item La comparación con la solución analítica revela elevada difusión numérica en ambos esquemas, indicando que la resolución de malla es insuficiente para capturar las discontinuidades con total precisión.

    \item La diferencia entre esquemas temporales (Euler vs Crank-Nicolson) afecta principalmente a la precisión en la posición de las ondas propagantes, siendo el esquema de segundo orden más fiel a las velocidades teóricas de propagación.

    \item El esquema espacial \textit{vanAlbada} (TVD) empleado para presión y energía proporciona buena captura de discontinuidades sin oscilaciones espurias, mientras que \textit{upwind} para la velocidad garantiza estabilidad.

    \item Para aplicaciones con ondas de choque, se recomienda combinar esquemas espaciales TVD con esquemas temporales de segundo orden, junto con mallas suficientemente refinadas en las regiones de discontinuidad.
\end{enumerate}

% Fin del capítulo 4
